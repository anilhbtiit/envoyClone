{
  "node": {
    "id": "1",
    "cluster": "test"
  },
  "static_resources": {
    "listeners": [
      {
        "name": "header_1",
        "address": {
          "socket_address": {
            "protocol": "TCP",
            "address": "{{ ntop_ip_loopback_address }}",
            "port_value": 0
          }
        },
        "filter_chains": [
          {
            "filters": [
              {
                "name": "envoy.http_connection_manager",
                "config": {
                  "codec_type": "HTTP1",
                  "stat_prefix": "router",
                  "route_config": {
                    "name": "config",
                    "virtual_hosts": [
                      {
                        "name": "no-headers",
                        "domains": [ "no-headers.com" ],
                        "routes": [
                          {
                            "match": {
                              "prefix": "/"
                            },
                            "route": {
                              "cluster": "cluster_1"
                            }
                          }
                        ]
                      },
                      {
                        "name": "vhost-headers",
                        "domains": [ "vhost-headers.com" ],
                        "routes": [
                          {
                            "match": {
                              "prefix": "/vhost-only"
                            },
                            "route": {
                              "cluster": "cluster_1"
                            }
                          },
                          {
                            "match": {
                              "prefix": "/vhost-and-route"
                            },
                            "route": {
                              "cluster": "cluster_1",
                              "request_headers_to_add": [
                                {
                                  "header": {
                                    "key": "x-route-request",
                                    "value": "route"
                                  },
                                  "append": {{ append }}
                                }
                              ],
                              "response_headers_to_add": [
                                {
                                  "header": {
                                    "key": "x-route-response",
                                    "value": "route"
                                  },
                                  "append": {{ append }}
                                }
                              ],
                              "response_headers_to_remove": [ "x-route-response-remove" ]
                            }
                          }
                        ],
                        "request_headers_to_add": [
                          {
                            "header": {
                              "key": "x-vhost-request",
                              "value": "vhost"
                            },
                            "append": {{ append }}
                          }
                        ],
                        "response_headers_to_add": [
                          {
                            "header": {
                              "key": "x-vhost-response",
                              "value": "vhost"
                            },
                            "append": {{ append }}
                          }
                        ],
                        "response_headers_to_remove": [ "x-vhost-response-remove" ]
                      },
                      {
                        "name": "route-headers",
                        "domains": [ "route-headers.com" ],
                        "routes": [
                          {
                            "match": {
                              "prefix": "/route-only"
                            },
                            "route": {
                              "cluster": "cluster_1",
                              "request_headers_to_add": [
                                {
                                  "header": {
                                    "key": "x-route-request",
                                    "value": "route"
                                  },
                                  "append": {{ append }}
                                }
                              ],
                              "response_headers_to_add": [
                                {
                                  "header": {
                                    "key": "x-route-response",
                                    "value": "route"
                                  },
                                  "append": {{ append }}
                                }
                              ],
                              "response_headers_to_remove": [ "x-route-response-remove" ]
                            }
                          }
                        ]
                      }
                    ],
                    "response_headers_to_add": [ {{ route_config_response_headers_to_add }}],
                    "response_headers_to_remove": [ {{ route_config_response_headers_to_remove }}],
                    "request_headers_to_add": [ {{ route_config_request_headers_to_add }} ]
                  },
                  "http_filters": [
                    {
                      "name": "envoy.router",
                      "config": { }
                    }
                  ]
                }
              }
            ]
          }
        ]
      }
    ],
    "clusters": [
      {
        "name": "cluster_1",
        "connect_timeout": { "seconds": 5 },
        "type": "STATIC",
        "lb_policy": "ROUND_ROBIN",
        "hosts": [
          {
            "socket_address": {
              "protocol": "TCP",
              "address": "{{ ntop_ip_loopback_address }}",
              "port_value": {{ upstream_0 }}
            }
          }
        ]
      }
    ]
  },
  "admin": {
    "access_log_path": "/dev/null",
    "address": {
      "socket_address": {
        "protocol": "TCP",
        "address": "{{ ntop_ip_loopback_address }}",
        "port_value": 0
      }
    }
  }
}
