<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="1112" height="678" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[participant Envoy as C
participant Management Server as S

C->S: {resource_names={(A)}}
S->C: {resources={(A)}, version=1, nonce=1}
C->S: {resource_names={(A)}, version=1, nonce=1 (this is an ACK)}
C->S: {resource_names={(A, B)}, version=1, nonce=1}
Note over C: adding subscription\nto B
S->C: {resources={(B)}, version=1, nonce=2}
Note over S: sends B, but system version\ndoes not change because\nserver has not gotten a\nnew config
C->S: {resource_names={(A, B)}, version=1, nonce=2, error_detail="B is invalid"}
Note over C: intended to NACK B
Note over S: needs to look at error_detail\nto detect NACK instead of\n using version and nonce
]]></source><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with RaphaÃ«l 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock55-objgl1jm" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj8020m" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj2g8dd" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-objlb3uc" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj5eluw" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-objno86b" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="72.1875" y="20" width="68" height="38.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="82.1875" y="30" width="48" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="106.1875" y="39.296875" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Envoy</tspan></text><rect x="72.1875" y="619.71875" width="68" height="38.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="82.1875" y="629.71875" width="48" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="106.1875" y="639.015625" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Envoy</tspan></text><path fill="none" stroke="#000000" d="M106.1875,58.59375L106.1875,619.71875" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="744.8125" y="20" width="183.1875" height="38.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="754.8125" y="30" width="163.1875" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="836.40625" y="39.296875" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Management Server</tspan></text><rect x="744.8125" y="619.71875" width="183.1875" height="38.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="754.8125" y="629.71875" width="163.1875" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="836.40625" y="639.015625" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Management Server</tspan></text><path fill="none" stroke="#000000" d="M836.40625,58.59375L836.40625,619.71875" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="365.71875" y="74.296875" width="211.15625" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="471.296875" y="83.59375" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resource_names={(A)}}</tspan></text><path fill="none" stroke="#000000" d="M106.1875,97.1875C106.1875,97.1875,767.1759882401675,97.1875,831.4028970095978,97.1875" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objgl1jm)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="293.734375" y="112.890625" width="355.125" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="471.296875" y="122.1875" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resources={(A)}, version=1, nonce=1}</tspan></text><path fill="none" stroke="#000000" d="M836.40625,135.78125C836.40625,135.78125,175.4177617598325,135.78125,111.19085299040216,135.78125" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj8020m)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="188.15625" y="151.484375" width="566.28125" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="471.296875" y="160.78125" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resource_names={(A)}, version=1, nonce=1 (this is an ACK)}</tspan></text><path fill="none" stroke="#000000" d="M106.1875,174.375C106.1875,174.375,767.1759882401675,174.375,831.4028970095978,174.375" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj2g8dd)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="255.34375" y="190.078125" width="431.90625" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="471.296875" y="199.375" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resource_names={(A, B)}, version=1, nonce=1}</tspan></text><path fill="none" stroke="#000000" d="M106.1875,212.96875C106.1875,212.96875,767.1759882401675,212.96875,831.4028970095978,212.96875" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objlb3uc)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="10" y="232.96875" width="192.375" height="47.78125" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="15" y="237.96875" width="182.375" height="37.78125" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="106.1875" y="256.859375" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="-5.3125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">adding subscription</tspan><tspan dy="19.2" x="106.1875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">to B</tspan></text><rect x="293.734375" y="296.453125" width="355.125" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="471.296875" y="305.75" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resources={(B)}, version=1, nonce=2}</tspan></text><path fill="none" stroke="#000000" d="M836.40625,319.34375C836.40625,319.34375,175.4177617598325,319.34375,111.19085299040216,319.34375" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj5eluw)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="701.828125" y="339.34375" width="269.15625" height="86.1875" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="706.828125" y="344.34375" width="259.15625" height="76.1875" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="836.40625" y="382.4375" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="-24.515625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">sends B, but system version</tspan><tspan dy="19.2" x="836.40625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">does not change because</tspan><tspan dy="19.2" x="836.40625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">server has not gotten a</tspan><tspan dy="19.2" x="836.40625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">new config</tspan></text><rect x="116.1875" y="441.234375" width="710.21875" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="471.296875" y="450.53125" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resource_names={(A, B)}, version=1, nonce=2, error_detail="B is invalid"}</tspan></text><path fill="none" stroke="#000000" d="M106.1875,464.125C106.1875,464.125,767.1759882401675,464.125,831.4028970095978,464.125" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objno86b)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="14.796875" y="484.125" width="182.78125" height="28.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="19.796875" y="489.125" width="172.78125" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="106.1875" y="498.421875" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="4.2890625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">intended to NACK B</tspan></text><rect x="692.234375" y="532.71875" width="288.34375" height="67" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="697.234375" y="537.71875" width="278.34375" height="57" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="836.40625" y="566.21875" text-anchor="middle" font-family="Andale Mono, monospace" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: &quot;Andale Mono&quot;, monospace; font-size: 16px;"><tspan dy="-14.9140625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">needs to look at error_detail</tspan><tspan dy="19.2" x="836.40625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">to detect NACK instead of</tspan><tspan dy="19.2" x="836.40625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"> using version and nonce</tspan></text></svg>
