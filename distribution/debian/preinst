#! /bin/sh

# preinst script for envoy

set -e

addenvoyuser() {
    if ! getent group envoy >/dev/null; then
        addgroup --system envoy >/dev/null
    fi

    if ! getent passwd envoy >/dev/null; then
        adduser \
          --system \
          --disabled-login \
          --ingroup envoy \
          --no-create-home \
          --home /nonexistent \
          --gecos "envoy user" \
          --shell /bin/false \
          envoy  >/dev/null

    fi
}


case "$1" in

    install)
        addenvoyuser
        cat <<BANNER

You are installing the Envoy proxy server.

Once installed, you can check your Envoy version by running the following in a terminal:

  $ envoy --version

Documentation for your version is available at:

  https://www.envoyproxy.io/docs

The Envoy project can be found at:

  https://github.com/envoyproxy/envoy

BANNER
        ;;

    upgrade)
        addenvoyuser
        ;;

    abort-upgrade)
        ;;

    *)
        echo "preinst called with unknown argument \`$1'" >&2
        exit 0
        ;;
esac

#DEBHELPER#

exit 0
