config {
  virtual_hosts {
    name: "vhost"
    domains: "www.lyft.com"
    routes {
      match {
        prefix: "/both"
      }
      route {
        weighted_clusters {
          clusters {
            name: "www1"
            weight {
              value: 100
            }
            metadata_match {
              filter_metadata {
                key: "envoy.lb"
                value {
                  fields {
                    key: "r1_wc_key"
                    value {
                      string_value: "r1_wc_value"
                    }
                  }
                }
              }
            }
          }
        }
        metadata_match {
          filter_metadata {
            key: "envoy.lb"
            value {
              fields {
                key: "r1_key"
                value {
                  string_value: "r1_value"
                }
              }
            }
          }
        }
      }
    }
    routes {
      match {
        prefix: "/cluster-only"
      }
      route {
        weighted_clusters {
          clusters {
            name: "www2"
            weight {
              value: 100
            }
            metadata_match {
              filter_metadata {
                key: "envoy.lb"
                value {
                  fields {
                    key: "r2_wc_key"
                    value {
                      string_value: "r2_wc_value"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    routes {
      match {
        prefix: "/route-only"
      }
      route {
        cluster: "www3"
        metadata_match {
          filter_metadata {
            key: "envoy.lb"
            value {
              fields {
                key: "r3_key"
                value {
                  string_value: "r3_value"
                }
              }
            }
          }
        }
      }
    }
    routes {
      match {
        prefix: "/cluster-passthrough"
      }
      route {
        weighted_clusters {
          clusters {
            name: "www4"
            weight {
              value: 100
            }
          }
        }
        metadata_match {
          filter_metadata {
            key: "envoy.lb"
            value {
              fields {
                key: "r4_key"
                value {
                  string_value: "r4_value"
                }
              }
            }
          }
        }
      }
    }
  }
}
headers {
  headers {
    key: ":authority"
    value: "www.lyft.com"
  }
  headers {
    key: ":path"
    value: "/cluster-only"
  }
  headers {
    key: "x-forwarded-proto"
    value: "https"
  }
  headers {
    key: "x-envoy-internal"
    value: "true"
  }
}
