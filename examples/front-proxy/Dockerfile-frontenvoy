FROM envoyproxy/envoy-dev:latest

RUN apt-get update && apt-get -q install -y \
    curl

RUN mkdir -p /etc/certs && \
    openssl req -x509 -newkey rsa:4096 \
        -keyout /etc/certs/key.pem \
        -out  /etc/certs/crt.pem \
        -days 365 -nodes -subj '/CN=front-envoy'

RUN id -u envoy | xargs -I{} chown -R {}:{} /etc/certs

CMD /usr/local/bin/envoy -c /etc/front-envoy.yaml --service-cluster front-proxy
