date: Pending

behavior_changes:
- area: tls-inspector
  change: |
    the listener filter tls inspector's stats ``connection_closed`` and ``read_error`` are removed. The new stats are introduced for listener, ``downstream_peek_remote_close`` and ``read_error`` :ref:`listener stats <config_listener_stats>`.
- area: tls
  change: |
    Change TLS transport socket and QUIC transport socket to support asynchronous cert validation extension. This behavior change can be reverted by setting runtime guard ``envoy.reloadable_features.tls_async_cert_validation`` to false.
    the listener filter tls inspector's stats ``connection_closed`` and ``read_error`` are removed. New stats are introduced for listener,
    ``downstream_peek_remote_close`` and ``read_error``, in :ref:`listener stats <config_listener_stats>`.
    the listener filter tls inspector's stats ``connection_closed`` and ``read_error`` are removed. New stats are introduced for listener, ``downstream_peek_remote_close`` and ``read_error``, in :ref:`listener stats <config_listener_stats>`.
- area: config
  change: |
    multiple SDS resources of multiple clusters or listeners are sent in a single SDS requests, instead of multiple SDS requests.
    This behavioral change can be reverted by setting ``envoy.reloadable_features.combine_sds_requests`` to ``false``.
- area: stats listener
  change: |
    fixed metric tag extraction so that :ref:`stat_prefix <envoy_v3_api_field_config.listener.v3.Listener.stat_prefix>`
    is properly extracted. This changes the Prometheus name from
    ``envoy_listener_myprefix_downstream_cx_overflow{}`` to ``envoy_listener_downstream_cx_overflow{envoy_listener_address="myprefix"}``.
    This does not affect the Prometheus name if ``stat_prefix`` is not set.
- area: stats listener
  change: |
    fixed metric tag extraction so that ``worker_id`` is properly extracted from the listener stats. This changes the Prometheus name from
    ``envoy_listener_worker_1_downstream_cx_active{envoy_listener_address="0.0.0.0_10000"}``
    to ``envoy_listener_downstream_cx_active{envoy_listener_address="0.0.0.0_10000", envoy_worker_id="1"}``.
- area: stats server
  change: |
    fixed metric tag extraction so that ``worker_id`` is properly extracted fromt the server stats. This changes the Prometheus name from
    ``envoy_server_worker_1_watchdog_miss{}`` to ``envoy_server_watchdog_miss{envoy_worker_id="1"}``.
- area: stats thrift_proxy
  change: |
    fixed metric tag extraction so that :ref:`stat_prefix <envoy_v3_api_field_extensions.filters.network.thrift_proxy.v3.ThriftProxy.stat_prefix>`
    is properly extracted. This changes the Prometheus name from
    ``envoy_thrift_myprefix_request{}`` to ``envoy_thrift_request{envoy_thrift_prefix="myprefix"}``.
- area: stats redis_proxy
  change: |
    fixed metric tag extraction so that :ref:`stat_prefix <envoy_v3_api_field_extensions.filters.network.redis_proxy.v3.RedisProxy.stat_prefix>`
    is properly extracted. This changes the Prometheus name from
    ``envoy_redis_myprefix_command_pttl_latency_sum{}`` to ``envoy_redis_command_pttl_latency_sum{envoy_redis_prefix="myprefix"}``.
- area: router
  change: |
    updated all HTTP filters to get per-filter config by the :ref:`HTTP filter config name
    <envoy_v3_api_field_extensions.filters.network.http_connection_manager.v3.HttpFilter.name>`.
    If there is no entry referred by the filter config name, the canonical filter name
    (e.g., ``envoy.filters.http.buffer`` for the HTTP buffer filter) will be used for the backwards
    compatibility.
- area: router
  change: |
    weighted cluster's :ref:`total_weight <envoy_v3_api_field_config.route.v3.WeightedCluster.total_weight>` is now
    optional. If not set, Envoy will no longer validate that all weights add up to 100. The sum of
    :ref:`weights <envoy_v3_api_field_config.route.v3.WeightedCluster.ClusterWeight.weight>`
    across all entries in the clusters array must add up to the
    :ref:`total_weight <envoy_v3_api_field_config.route.v3.WeightedCluster.total_weight>`, when it's greater than 0.

minor_behavior_changes:
- area: thrift
  change: |
    keep downstream connection if the response is completed without underflow.
- area: tls
  change: |
    if both :ref:`match_subject_alt_names <envoy_v3_api_field_extensions.transport_sockets.tls.v3.CertificateValidationContext.match_subject_alt_names>`
    and :ref:`match_typed_subject_alt_names <envoy_v3_api_field_extensions.transport_sockets.tls.v3.CertificateValidationContext.match_typed_subject_alt_names>`
    are specified, the former (deprecated) field is ignored. Previously, setting both fields would result in an error.
- area: tls
  change: |
    removed SHA-1 and RSA key transport cipher suites from the server-side defaults.
- area: tls
  change: |
    Change TLS transport socket and QUIC transport socket to support asynchronous cert validation extension. This behavior change can be reverted by setting runtime guard ``envoy.reloadable_features.tls_async_cert_validation`` to false.
    the listener filter tls inspector's stats ``connection_closed`` and ``read_error`` are removed. New stats are introduced for listener, ``downstream_peek_remote_close`` and ``read_error``, in :ref:`listener stats <config_listener_stats>`.
- area: http
  change: |
    the behavior of the :ref:`timeout <envoy_v3_api_field_config.core.v3.KeepaliveSettings.timeout>`
    field has been modified to extend the timeout when *any* frame is received on the owning HTTP/2
    connection. This negates the effect of head-of-line (HOL) blocking for slow connections. If
    any frame is received the assumption is that the connection is working. This behavior change
    can be reverted by setting ``envoy.reloadable_features.http2_delay_keepalive_timeout`` to ``false``.
- area: http
  change: |
    changing the behavior for ``CONNECT`` and upgrade requests over HTTP/1.1 to not delay close. This behavioral change
    can be reverted by setting ``envoy.reloadable_features.no_delay_close_for_upgrades`` to ``false``.
- area: http
  change: |
    the :ref:`dynamo filter <config_http_filters_dynamo>` has been moved to :ref:`contrib images <install_contrib>`.
- area: http-cache
  change: |
    HTTP cache filter ``getCache`` interface changed from returning a reference to
    returning a shared_ptr - any third-party implementations of this interface will need to be
    updated accordingly. See changes to ``simple_http_cache.cc`` and ``simple_http_cache.h`` in
    `PR21114 <https://github.com/envoyproxy/envoy/pull/21114>`_ for example.
- area: lua
  change: |
    export symbols of LuaJit by default on Linux. This is useful in cases where you have a lua script
    that loads shared object libraries, such as those installed via luarocks.
- area: admin
  change: |
    changed default regex engine for ``/stats?filter=`` from ``std::regex`` to RE2, improving
    filtering speed 20x.
- area: skywalking
  change: |
    use request path as operation name of ``ENTRY``/``EXIT`` spans.
- area: skywalking
  change: |
    use upstream host address as ``addressUsedAtClient`` in propagation header.
- area: dns
  change: |
    allow propagating DNS responses with no records back to callers like ``strict_dns`` cluster,
    guarded by ``envoy.reloadable_features.cares_accept_nodata``.
- area: local_ratelimit
  change: |
    ``local_ratelimit`` will consume tokens of all matched descriptors sorted by tokens per second.
    This behavioral change can be reverted by setting runtime guard
    ``envoy.reloadable_features.http_local_ratelimit_match_all_descriptors`` to ``false``.
- area: router
  change: |
    get route config factories by the configuration proto full names by default. This behavior change
    can be reverted by setting the ``envoy.reloadable_features.get_route_config_factory_by_type``
    runtime flag to ``false``.
- area: lua
  change: |
    lua ``respond`` api will call ``sendLocalReply`` instead of ``encodeHeaders`` and ``encodeData``.
    This means that encoder filters will be correctly invoked, including adding configured response
    headers, etc. This behavioral change can be reverted by setting runtime guard
    ``envoy.reloadable_features.lua_respond_with_send_local_reply`` to ``false``.
- area: logging
  change: |
    changed flag ``--log-format-escaped`` to only log one trailing newline per log line.
- area: logging
  change: |
    changed category name for access log filter extensions to ``envoy.access_loggers.extension_filters``.
- area: filter state
  change: |
    revert to respecting the life time of the filter state objects to be bound to the original stream and make sharing
    filter state objects with the upstream info explicit via an extra flag in ``setData``.
- area: tracers
  change: |
    remove unnecessary ``spawnChild`` annotations in OpenCensus tracer.
- area: conn pool
  change: |
    changed HTTP/2 connection pooling and the :ref:`ALPN pool <envoy_v3_api_field_extensions.upstreams.http.v3.HttpProtocolOptions.auto_config>`
    to remember the number of streams allowed by the endpoint and cap multiplexed streams for subsequent connections based on that.
    With that working, defaulted the ALPN pool to assume HTTP/2 will work, as it will only incur a latency hit once until the TLS handshake is complete,
    and then will cache that the effective stream limit is ``1``. This behavioral change can be revered by setting
    ``envoy.reloadable_features.allow_concurrency_for_alpn_pool`` to ``false``.
- area: network
  change: |
    the :ref:`client ssl auth filter <config_network_filters_client_ssl_auth>` has been moved to :ref:`contrib images <install_contrib>`.
- area: tcp_proxy
  change: |
    added support for command operators in :ref:`TunnelingConfig hostname <envoy_v3_api_field_extensions.filters.network.tcp_proxy.v3.TcpProxy.TunnelingConfig.hostname>`
    to dynamically set upstream hostname.
# *Changes that are expected to cause an incompatibility if applicable; deployment changes are likely required*

minor_behavior_changes:
# *Changes that may cause incompatibilities for some users, but should not for most*

bug_fixes:
# *Changes expected to improve the state of the world and are unlikely to have negative effects*

removed_config_or_runtime:
# *Normally occurs at the end of the* :ref:`deprecation period <deprecated>`

new_features:
- area: listener
  change: |
    added multiple listening addresses in single listener. :ref:`listener additional addresses<envoy_v3_api_field_config.listener.v3.Listener.additional_addresses>`.

deprecated:
