From 0ec11191170a5298d2b4452a7b313195ca46b71d Mon Sep 17 00:00:00 2001
From: Ismo Puustinen <ismo.puustinen@intel.com>
Date: Thu, 21 Jan 2021 14:49:50 +0200
Subject: [PATCH 1/5] BoringSSL compatibility fix.

---
 sources/ippcp/crypto_mb/src/common/ifma_cvt52.c      | 6 ++++++
 sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p256.c | 3 +++
 sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p384.c | 3 +++
 sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p521.c | 3 +++
 4 files changed, 15 insertions(+)

diff --git a/sources/ippcp/crypto_mb/src/common/ifma_cvt52.c b/sources/ippcp/crypto_mb/src/common/ifma_cvt52.c
index b1300f87..11100d8a 100644
--- a/sources/ippcp/crypto_mb/src/common/ifma_cvt52.c
+++ b/sources/ippcp/crypto_mb/src/common/ifma_cvt52.c
@@ -167,6 +167,12 @@ __INLINE void transform_8sb_to_mb8(U64 out_mb8[], int bitLen, int8u *inp[8], int
    }
 }
 
+#ifdef OPENSSL_IS_BORINGSSL
+static int BN_bn2lebinpad(const BIGNUM *a, unsigned char *to, int tolen) {
+    return BN_bn2le_padded(to, tolen, a);
+}
+#endif
+
 #ifndef BN_OPENSSL_DISABLE
 // Convert BIGNUM into MB8(Radix=2^52) format
 // Returns bitmask of succesfully converted values
diff --git a/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p256.c b/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p256.c
index c991c888..1ee93447 100644
--- a/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p256.c
+++ b/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p256.c
@@ -24,6 +24,9 @@
 #ifndef BN_OPENSSL_DISABLE
 #include <openssl/bn.h>
 #include <openssl/ec.h>
+#ifdef OPENSSL_IS_BORINGSSL
+#include <openssl/ecdsa.h>
+#endif
 #endif
 
 
diff --git a/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p384.c b/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p384.c
index dd2dcd1d..f61208b3 100644
--- a/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p384.c
+++ b/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p384.c
@@ -24,6 +24,9 @@
 #ifndef BN_OPENSSL_DISABLE
 #include <openssl/bn.h>
 #include <openssl/ec.h>
+#ifdef OPENSSL_IS_BORINGSSL
+#include <openssl/ecdsa.h>
+#endif
 #endif
 
 /*
diff --git a/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p521.c b/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p521.c
index bf115e52..de0f4abd 100644
--- a/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p521.c
+++ b/sources/ippcp/crypto_mb/src/ecnist/ifma_ecdsa_p521.c
@@ -24,6 +24,9 @@
 #ifndef BN_OPENSSL_DISABLE
 #include <openssl/bn.h>
 #include <openssl/ec.h>
+#ifdef OPENSSL_IS_BORINGSSL
+#include <openssl/ecdsa.h>
+#endif
 #endif
 
 
-- 
2.25.1

